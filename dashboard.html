<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard — SaaSMarket</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Inter', sans-serif; }
    .fade-in { animation: fadeIn 240ms ease-out; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body class="bg-[#f6f7f9] text-slate-900 antialiased">

<nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
    <a href="index.html" class="font-black tracking-tight text-xl">
      SaaS<span class="text-indigo-600">Market</span>
    </a>

    <div class="flex items-center gap-6">
      <span id="user-email" class="text-sm text-slate-600"></span>
      <button id="btn-logout" class="text-sm text-slate-600 hover:text-slate-900">
        Sair
      </button>
    </div>
  </div>
</nav>

<div id="tela-login" class="min-h-[calc(100vh-4rem)] flex items-center justify-center px-6 fade-in">
  <div class="max-w-md w-full">
    <div class="text-center mb-12">
      <h1 class="text-4xl font-black mb-4">
        Bem-vindo ao <span class="text-indigo-600">SaaSMarket</span>
      </h1>
      <p class="text-slate-600">
        Entre para publicar e monetizar seu Micro-SaaS
      </p>
    </div>

    <div class="bg-white rounded-2xl shadow-xl p-10">
      <div class="mb-8">
        <label class="block text-sm font-semibold mb-2">Email</label>
        <input type="email" id="email" placeholder="seu@email.com" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500"/>
      </div>

      <div class="mb-8">
        <label class="block text-sm font-semibold mb-2">Senha</label>
        <input type="password" id="senha" placeholder="••••••••" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500"/>
      </div>

      <button onclick="fazerLogin()" id="btn-login" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold hover:bg-indigo-700 transition mb-4">
        Entrar / Cadastrar
      </button>

      <p class="text-xs text-center text-slate-500">Ao continuar, você concorda com os Termos de Uso</p>
    </div>
  </div>
</div>

<div id="dashboard" class="hidden max-w-7xl mx-auto px-6 py-10 fade-in">
  <div class="grid lg:grid-cols-[260px_1fr] gap-8">
    <aside class="bg-white rounded-2xl p-4 h-fit border border-slate-200">
      <p class="text-xs uppercase tracking-widest text-slate-400 px-3 py-2">Navegação</p>
      <button onclick="mudarSecao('recepcao')" id="menu-recepcao" class="w-full text-left px-3 py-2 rounded-lg text-sm font-semibold bg-indigo-50 text-indigo-700">Recepção</button>
      <button onclick="mudarSecao('visao')" id="menu-visao" class="w-full text-left px-3 py-2 rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-100">Meus Negócios</button>
      <button onclick="mudarSecao('publicar')" id="menu-publicar" class="w-full text-left px-3 py-2 rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-100">Publicar Micro-SaaS</button>
      <button onclick="mudarSecao('loja')" id="menu-loja" class="w-full text-left px-3 py-2 rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-100">Loja / Marketplace</button>
      <button onclick="mudarSecao('vendas')" id="menu-vendas" class="w-full text-left px-3 py-2 rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-100">Vendas</button>
      <button onclick="mudarSecao('conta')" id="menu-conta" class="w-full text-left px-3 py-2 rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-100">Conta Stripe</button>
    </aside>

    <main>
      <section id="content-recepcao" class="space-y-6">
        <div class="bg-white rounded-2xl p-8 border border-slate-200">
          <h2 class="text-3xl font-black mb-2">Dashboard Interativo</h2>
          <p class="text-slate-600">Escolha seu fluxo: publicar seu Micro-SaaS ou explorar a vitrine para comprar.</p>
        </div>
        <div class="grid md:grid-cols-2 gap-6">
          <button onclick="mudarSecao('publicar')" class="bg-indigo-600 text-white p-8 rounded-2xl text-left hover:bg-indigo-700 transition">
            <p class="text-xs uppercase tracking-widest mb-3 text-indigo-100">Botão A</p>
            <h3 class="text-2xl font-extrabold mb-2">Quero Publicar meu Micro-SaaS</h3>
            <p class="text-indigo-100">Cadastre função, endpoint e micro-valor por uso.</p>
          </button>
          <button onclick="mudarSecao('loja')" class="bg-white border border-slate-200 p-8 rounded-2xl text-left hover:border-indigo-300 transition">
            <p class="text-xs uppercase tracking-widest mb-3 text-slate-500">Botão B</p>
            <h3 class="text-2xl font-extrabold mb-2">Explorar Marketplace</h3>
            <p class="text-slate-600">Veja produtos ativos e vá para checkout em poucos cliques.</p>
          </button>
        </div>
      </section>

      <section id="content-visao" class="hidden space-y-6">
        <div class="grid md:grid-cols-3 gap-4">
          <div class="bg-white p-6 rounded-2xl border border-slate-200">
            <p class="text-sm text-slate-500">Saldo para compras</p>
            <p id="saldo-compras" class="text-3xl font-black mt-2">R$ 0,00</p>
          </div>
          <div class="bg-white p-6 rounded-2xl border border-slate-200">
            <p class="text-sm text-slate-500">Micro-frações acumuladas</p>
            <p id="micro-fracoes" class="text-3xl font-black mt-2">R$ 0,00</p>
          </div>
          <div class="bg-white p-6 rounded-2xl border border-slate-200">
            <p class="text-sm text-slate-500">Publicações</p>
            <p id="total-publicacoes" class="text-3xl font-black mt-2">0</p>
          </div>
        </div>

        <div class="bg-white rounded-2xl border border-slate-200 p-6">
          <h3 class="text-xl font-bold mb-4">Visão Geral de Ganhos</h3>
          <canvas id="grafico-ganhos" height="110"></canvas>
        </div>

        <div class="bg-white rounded-2xl border border-slate-200 p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-bold">Vitrine de Micro-SaaS</h3>
            <button onclick="mudarSecao('publicar')" class="text-sm font-semibold text-indigo-600 hover:underline">+ Publicar Novo Micro-SaaS</button>
          </div>
          <div id="lista-micro-saas" class="space-y-3"></div>
        </div>
      </section>

      <section id="content-publicar" class="hidden bg-white rounded-2xl border border-slate-200 p-8">
        <h2 class="text-3xl font-black mb-2">Publicar Micro-SaaS</h2>
        <p class="text-slate-600 mb-8">Formulário de publicação + validação automática (status 200/201).</p>

        <form onsubmit="salvarProduto(event)" class="space-y-5">
          <div class="grid md:grid-cols-2 gap-5">
            <div>
              <label class="block text-sm font-semibold mb-2">Nome do Micro-SaaS *</label>
              <input type="text" id="produto-nome-input" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Ex: API de Enriquecimento de Leads"/>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-2">Função principal *</label>
              <input type="text" id="produto-funcao-input" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Ex: Automatizar qualificação"/>
            </div>
          </div>

          <div class="grid md:grid-cols-2 gap-5">
            <div>
              <label class="block text-sm font-semibold mb-2">Endpoint da API *</label>
              <input type="url" id="produto-endpoint-input" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="https://api.seu-saas.com/health"/>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-2">Micro-valor por processamento (R$) *</label>
              <input type="number" id="produto-preco-input" required step="0.01" min="0.01" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="0.05"/>
            </div>
          </div>

          <div>
            <label class="block text-sm font-semibold mb-2">Descrição curta *</label>
            <textarea id="produto-descricao-input" required rows="3" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Resumo do que este Micro-SaaS resolve"></textarea>
          </div>

          <div class="grid md:grid-cols-2 gap-5">
            <div>
              <label class="block text-sm font-semibold mb-2">Stripe Price ID *</label>
              <input type="text" id="produto-stripe-price-input" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="price_xxx"/>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-2">Stripe Product ID *</label>
              <input type="text" id="produto-stripe-product-input" required class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="prod_xxx"/>
            </div>
          </div>

          <button type="submit" id="btn-salvar-produto" class="bg-indigo-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-indigo-700 transition">
            Publicar e validar
          </button>
        </form>
      </section>

      <section id="content-loja" class="hidden space-y-4">
        <h2 class="text-3xl font-black">Vitrine de Compras</h2>
        <div id="cards-loja" class="grid md:grid-cols-2 xl:grid-cols-3 gap-5"></div>
      </section>

      <section id="content-vendas" class="hidden bg-white rounded-2xl border border-slate-200 p-8">
        <h2 class="text-3xl font-black mb-8">Vendas</h2>
        <div class="grid md:grid-cols-3 gap-4 mb-8">
          <div class="p-5 bg-slate-50 rounded-xl"><p class="text-sm text-slate-500">Total</p><p id="total-vendas" class="text-3xl font-black">R$ 0,00</p></div>
          <div class="p-5 bg-slate-50 rounded-xl"><p class="text-sm text-slate-500">Assinaturas ativas</p><p id="assinaturas-ativas" class="text-3xl font-black">0</p></div>
          <div class="p-5 bg-slate-50 rounded-xl"><p class="text-sm text-slate-500">Este mês</p><p id="vendas-mes" class="text-3xl font-black">R$ 0,00</p></div>
        </div>
        <div id="tabela-vendas" class="text-sm text-slate-600 space-y-3"></div>
      </section>

      <section id="content-conta" class="hidden bg-white rounded-2xl border border-slate-200 p-8">
        <h2 class="text-3xl font-black mb-5">Conta Stripe</h2>
        <p id="status-conta" class="text-slate-600"></p>
      </section>
    </main>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="config.js"></script>

<!-- Vercel Speed Insights -->
<script>
  window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };
</script>
<script defer src="/_vercel/speed-insights/script.js"></script>

<script>
let userAtual = null;
let sellerAtual = null;
let meusProdutos = [];
let minhasVendas = [];
let produtosMarketplace = [];

function mudarSecao(secao) {
  ['recepcao', 'visao', 'publicar', 'loja', 'vendas', 'conta'].forEach((item) => {
    document.getElementById(`content-${item}`).classList.add('hidden');
    document.getElementById(`menu-${item}`).classList.remove('bg-indigo-50', 'text-indigo-700');
    document.getElementById(`menu-${item}`).classList.add('text-slate-700');
  });

  document.getElementById(`content-${secao}`).classList.remove('hidden');
  document.getElementById(`menu-${secao}`).classList.add('bg-indigo-50', 'text-indigo-700');
}

async function verificarAuth() {
  const { data: { session } } = await supabase.auth.getSession();

  if (!session) {
    document.getElementById('tela-login').classList.remove('hidden');
    document.getElementById('dashboard').classList.add('hidden');
    document.getElementById('user-email').textContent = '';
    return;
  }

  userAtual = session.user;
  document.getElementById('user-email').textContent = userAtual.email;

  // Novo fluxo: após autenticação válida, abre o Hub central
  window.location.href = 'hub.html';
  return;

  const { data: seller, error: sellerError } = await supabase.from('sellers').select('*').eq('id', userAtual.id).maybeSingle();

  if (sellerError) {
    throw sellerError;
  }

  if (!seller) {
    const { error: upsertSellerError } = await supabase.from('sellers').upsert({
      id: userAtual.id,
      email: userAtual.email,
      nome: (userAtual.email || '').split('@')[0] || 'seller'
    });

    if (upsertSellerError) {
      throw upsertSellerError;
    }

    const { data: sellerCriado, error: sellerCriadoError } = await supabase.from('sellers').select('*').eq('id', userAtual.id).maybeSingle();
    if (sellerCriadoError) throw sellerCriadoError;

    sellerAtual = sellerCriado;
  } else {
    sellerAtual = seller;
  }

  document.getElementById('tela-login').classList.add('hidden');
  document.getElementById('dashboard').classList.remove('hidden');

  await carregarDadosDashboard();
  mudarSecao('recepcao');
}

async function fazerLogin() {
  const email = document.getElementById('email').value;
  const senha = document.getElementById('senha').value;
  const btn = document.getElementById('btn-login');

  if (!email || !senha) {
    alert('Preencha email e senha.');
    return;
  }

  btn.disabled = true;
  btn.textContent = 'Processando...';

  try {
    let { data, error } = await supabase.auth.signInWithPassword({ email, password: senha });

    if (error) {
      const { data: signUpData, error: signUpError } = await supabase.auth.signUp({ email, password: senha });
      if (signUpError) throw signUpError;

      data = signUpData;
      if (signUpData.user) {
        const { error: upsertError } = await supabase.from('sellers').upsert({
          id: signUpData.user.id,
          email,
          nome: email.split('@')[0]
        });

        if (upsertError) throw upsertError;
      }
    }

    if (data?.session || data?.user) {
      window.location.href = 'hub.html';
      
      await verificarAuth();
      main
      return;
    }

    throw new Error('Não foi possível validar a autenticação.');
  } catch (error) {
    alert('Erro: ' + error.message);
  } finally {
    btn.disabled = false;
    btn.textContent = 'Entrar / Cadastrar';
  }
}

async function carregarDadosDashboard() {
  const [produtosRes, comprasRes, lojaRes] = await Promise.all([
    supabase.from('produtos').select('*').eq('seller_id', userAtual.id).order('created_at', { ascending: false }),
    supabase.from('compras').select('*, produtos(nome)').eq('seller_id', userAtual.id).order('created_at', { ascending: false }),
    supabase.from('produtos').select('*').eq('ativo', true).order('created_at', { ascending: false })
  ]);

  if (produtosRes.error) throw produtosRes.error;
  if (comprasRes.error) throw comprasRes.error;
  if (lojaRes.error) throw lojaRes.error;

  meusProdutos = produtosRes.data || [];
  minhasVendas = comprasRes.data || [];
  produtosMarketplace = lojaRes.data || [];

  renderVisao();
  renderVendas();
  renderLoja();
  renderConta();
}

function obterStatusProduto(produto) {
  if (produto.verificado) return { nome: 'Validado', cor: 'bg-emerald-100 text-emerald-700' };
  if (produto.ativo) return { nome: 'Ativo', cor: 'bg-blue-100 text-blue-700' };
  return { nome: 'Processando', cor: 'bg-amber-100 text-amber-700' };
}

function renderVisao() {
  const totalVendas = minhasVendas.reduce((acc, item) => acc + Number(item.valor || 0), 0);
  const microFracoes = totalVendas * 0.1;

  document.getElementById('saldo-compras').textContent = `R$ ${totalVendas.toFixed(2)}`;
  document.getElementById('micro-fracoes').textContent = `R$ ${microFracoes.toFixed(2)}`;
  document.getElementById('total-publicacoes').textContent = meusProdutos.length;

  const lista = document.getElementById('lista-micro-saas');
  if (!meusProdutos.length) {
    lista.innerHTML = '<p class="text-slate-500">Você ainda não publicou nenhum Micro-SaaS.</p>';
  } else {
    lista.innerHTML = meusProdutos.map((produto) => {
      const status = obterStatusProduto(produto);
      return `
        <div class="flex items-center justify-between border border-slate-200 rounded-xl p-4">
          <div>
            <p class="font-semibold">${produto.nome}</p>
            <p class="text-sm text-slate-500">${produto.descricao || ''}</p>
          </div>
          <span class="text-xs px-3 py-1 rounded-full ${status.cor}">${status.nome}</span>
        </div>
      `;
    }).join('');
  }

  desenharGraficoGanhos(minhasVendas);
}

function desenharGraficoGanhos(vendas) {
  const canvas = document.getElementById('grafico-ganhos');
  if (!canvas) return;

  const ctx = canvas.getContext('2d');
  if (!ctx) return;

  const width = canvas.width = canvas.offsetWidth;
  const height = canvas.height = 220;

  ctx.clearRect(0, 0, width, height);

  const meses = Array.from({ length: 6 }, (_, i) => {
    const d = new Date();
    d.setMonth(d.getMonth() - (5 - i));
    return d;


});

  const pontos = meses.map((mes) => {
    const totalMes = vendas
      .filter((v) => {
        const data = new Date(v.created_at);
        return data.getMonth() === mes.getMonth() && data.getFullYear() === mes.getFullYear();
      })
      .reduce((acc, v) => acc + Number(v.valor || 0), 0);
    return totalMes;
  });

  const max = Math.max(...pontos, 1);
  const padding = 28;
  const stepX = (width - padding * 2) / (pontos.length - 1 || 1);

  ctx.lineWidth = 2;
  ctx.strokeStyle = '#4f46e5';
  ctx.beginPath();

  pontos.forEach((valor, index) => {
    const x = padding + stepX * index;
    const y = height - padding - ((height - padding * 2) * (valor / max));
    if (index === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  });

  });

  const pontos = meses.map((mes) => {
    const totalMes = vendas
      .filter((v) => {
        const data = new Date(v.created_at);
        return data.getMonth() === mes.getMonth() && data.getFullYear() === mes.getFullYear();
      })
      .reduce((acc, v) => acc + Number(v.valor || 0), 0);
    return totalMes;
  });

  const max = Math.max(...pontos, 1);
  const padding = 28;
  const stepX = (width - padding * 2) / (pontos.length - 1 || 1);

  ctx.lineWidth = 2;
  ctx.strokeStyle = '#4f46e5';
  ctx.beginPath();

  pontos.forEach((valor, index) => {
    const x = padding + stepX * index;
    const y = height - padding - ((height - padding * 2) * (valor / max));
    if (index === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  });

     main

  ctx.stroke();

  ctx.fillStyle = '#4f46e5';
  pontos.forEach((valor, index) => {
    const x = padding + stepX * index;
    const y = height - padding - ((height - padding * 2) * (valor / max));
    ctx.beginPath();
    ctx.arc(x, y, 3, 0, Math.PI * 2);
    ctx.fill();
  });
}

function renderLoja() {
  const container = document.getElementById('cards-loja');

  if (!produtosMarketplace.length) {
    container.innerHTML = '<p class="text-slate-500 col-span-full">Nenhum Micro-SaaS disponível no momento.</p>';
    return;
  }

  container.innerHTML = produtosMarketplace.map((produto) => `
    <div class="bg-white rounded-2xl border border-slate-200 p-5">
      <h3 class="font-bold text-lg mb-2">${produto.nome}</h3>
      <p class="text-sm text-slate-600 mb-4">${produto.descricao}</p>
      <p class="text-sm font-semibold mb-4">R$ ${Number(produto.preco).toFixed(2)} por processamento</p>
      <a href="produto.html?id=${produto.id}" class="inline-block bg-slate-900 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-800 transition">Checkout</a>
    </div>
  `).join('');
}

function renderVendas() {
  const total = minhasVendas.reduce((sum, v) => sum + Number(v.valor || 0), 0);
  const ativas = minhasVendas.filter((v) => v.status === 'completed').length;
  const mesAtual = new Date().getMonth();
  const esteMes = minhasVendas
    .filter((v) => new Date(v.created_at).getMonth() === mesAtual)
    .reduce((sum, v) => sum + Number(v.valor || 0), 0);

  document.getElementById('total-vendas').textContent = `R$ ${total.toFixed(2)}`;
  document.getElementById('assinaturas-ativas').textContent = ativas;
  document.getElementById('vendas-mes').textContent = `R$ ${esteMes.toFixed(2)}`;

  const tabela = document.getElementById('tabela-vendas');
  if (!minhasVendas.length) {
    tabela.innerHTML = '<p>Nenhuma venda registrada ainda.</p>';
    return;
  }

  tabela.innerHTML = minhasVendas.map((v) => `
    <div class="border border-slate-200 rounded-xl px-4 py-3 flex justify-between gap-3">
      <span><strong>${v.produtos?.nome || 'Produto'}</strong> • ${v.comprador_email}</span>
      <span>R$ ${Number(v.valor).toFixed(2)} • ${v.status}</span>
    </div>
  `).join('');
}

function renderConta() {
  const status = document.getElementById('status-conta');
  if (sellerAtual?.stripe_account_id) {
    status.innerHTML = `Conta conectada: <strong>${sellerAtual.stripe_account_id}</strong>.`; 
  } else {
    status.innerHTML = 'Nenhuma conta Stripe conectada ainda.';
  }
}

async function validarEndpoint(endpoint) {
  const controller = new AbortController();
  const timeout = setTimeout(() => controller.abort(), 7000);

  try {
    const resposta = await fetch(endpoint, { method: 'GET', signal: controller.signal });
    return resposta.status === 200 || resposta.status === 201;
  } catch (_) {
    return false;
  } finally {
    clearTimeout(timeout);
  }
}

async function salvarProduto(event) {
  event.preventDefault();
  const btn = document.getElementById('btn-salvar-produto');

  btn.disabled = true;
  btn.textContent = 'Validando endpoint...';

  try {
    const endpoint = document.getElementById('produto-endpoint-input').value;
    const validado = await validarEndpoint(endpoint);

    const { error } = await supabase.from('produtos').insert({
      seller_id: userAtual.id,
      nome: document.getElementById('produto-nome-input').value,
      descricao: document.getElementById('produto-descricao-input').value,
      descricao_longa: `Função: ${document.getElementById('produto-funcao-input').value}\nEndpoint: ${endpoint}`,
      preco: document.getElementById('produto-preco-input').value,
      stripe_price_id: document.getElementById('produto-stripe-price-input').value,
      stripe_product_id: document.getElementById('produto-stripe-product-input').value,
      verificado: validado,
      ativo: validado,
      categoria: 'Micro-SaaS'
    });

    if (error) throw error;

    alert(validado
      ? 'Micro-SaaS validado com status 200/201 e publicado na vitrine.'
      : 'Micro-SaaS recebido. Status: Processando (aguardando validação).');

    event.target.reset();
    await carregarDadosDashboard();
    mudarSecao('visao');
  } catch (error) {
    alert('Erro ao publicar Micro-SaaS: ' + error.message);
  } finally {
    btn.disabled = false;
    btn.textContent = 'Publicar e validar';
  }
}

async function logout() {
  try {
    await supabase.auth.signOut();
  } catch (error) {
    console.error('Erro ao sair da sessão:', error);
  } finally {
    window.location.href = 'index.html';
  }
}

window.onload = async () => {
  const btnLogout = document.getElementById('btn-logout');
  if (btnLogout) {
    btnLogout.addEventListener('click', async () => {
      await logout();
    });
  }


  
  }
}

async function logout() {
  await supabase.auth.signOut();
  window.location.href = 'index.html';
}

window.onload = async () => {
  try {
    await verificarAuth();
  } catch (error) {
    console.error('Erro ao iniciar dashboard:', error);
    alert('Não foi possível carregar seu dashboard agora. Tente novamente em instantes.');
    document.getElementById('tela-login').classList.remove('hidden');
    document.getElementById('dashboard').classList.add('hidden');
  }
};
</script>

</body>
</html>
