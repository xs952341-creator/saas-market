<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login ‚Äî SaaSMarket</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>body { font-family: 'Inter', sans-serif; }</style>
</head>

<body class="bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900 min-h-screen flex items-center justify-center px-6">
<div class="max-w-md w-full">
  <div class="text-center mb-12">
    <div class="flex items-center justify-center gap-3 mb-4">
      <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl"></div>
      <span class="font-black text-3xl text-white">SaaS<span class="text-indigo-400">Market</span></span>
    </div>
    <p class="text-slate-400">O marketplace de Micro-SaaS pay-per-use</p>
  </div>

  <div class="bg-white/10 backdrop-blur-lg border border-white/20 rounded-3xl p-10 shadow-2xl">
    <div class="flex gap-4 mb-8">
      <button id="tab-login" onclick="mudarTab('login')" class="flex-1 py-3 rounded-xl font-bold transition bg-indigo-600 text-white">Entrar</button>
      <button id="tab-cadastro" onclick="mudarTab('cadastro')" class="flex-1 py-3 rounded-xl font-bold transition text-slate-300 hover:bg-white/5">Cadastrar</button>
    </div>

    <form id="form-login" onsubmit="fazerLogin(event)">
      <div class="space-y-4 mb-6">
        <div>
          <label class="block text-sm font-semibold text-white mb-2">Email</label>
          <input type="email" id="login-email" required placeholder="seu@email.com" class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"/>
        </div>
        <div>
          <label class="block text-sm font-semibold text-white mb-2">Senha</label>
          <input type="password" id="login-senha" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"/>
        </div>
      </div>

      <button type="submit" id="btn-login" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-indigo-700 transition mb-4">Entrar</button>
    </form>

    <form id="form-cadastro" class="hidden" onsubmit="fazerCadastro(event)">
      <div class="space-y-4 mb-6">
        <div>
          <label class="block text-sm font-semibold text-white mb-2">Nome</label>
          <input type="text" id="cadastro-nome" required placeholder="Seu nome" class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"/>
        </div>
        <div>
          <label class="block text-sm font-semibold text-white mb-2">Email</label>
          <input type="email" id="cadastro-email" required placeholder="seu@email.com" class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"/>
        </div>
        <div>
          <label class="block text-sm font-semibold text-white mb-2">Senha</label>
          <input type="password" id="cadastro-senha" required minlength="6" placeholder="M√≠nimo 6 caracteres" class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"/>
        </div>
      </div>

      <button type="submit" id="btn-cadastro" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-indigo-700 transition mb-4">Criar Conta</button>
    </form>

    <div class="relative my-8">
      <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-white/10"></div></div>
      <div class="relative flex justify-center text-sm"><span class="px-4 bg-slate-900/50 text-slate-400">ou continue com</span></div>
    </div>

    <div class="grid grid-cols-2 gap-4">
      <button onclick="loginGoogle()" class="flex items-center justify-center gap-3 px-4 py-3 bg-white/5 border border-white/10 rounded-xl hover:bg-white/10 transition"><span class="text-white font-semibold">Google</span></button>
      <button onclick="loginGitHub()" class="flex items-center justify-center gap-3 px-4 py-3 bg-white/5 border border-white/10 rounded-xl hover:bg-white/10 transition"><span class="text-white font-semibold">GitHub</span></button>
    </div>
  </div>

  <div class="text-center mt-8">
    <a href="index.html" class="text-slate-400 hover:text-white text-sm">‚Üê Voltar para home</a>
  </div>
</div>

<div id="toast" class="hidden fixed top-6 right-6 bg-slate-800 border border-white/20 text-white px-6 py-4 rounded-xl shadow-2xl z-50">
  <p id="toast-message"></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script type="module">
  import './js/config.js';
  import { loginComEmail, cadastrarComEmail, loginComOAuth, getUsuarioAtual } from './js/auth.js';

  const loginBtn = document.getElementById('btn-login');
  const cadastroBtn = document.getElementById('btn-cadastro');

  window.mudarTab = function(tab) {
    const tabLogin = document.getElementById('tab-login');
    const tabCadastro = document.getElementById('tab-cadastro');
    const formLogin = document.getElementById('form-login');
    const formCadastro = document.getElementById('form-cadastro');

    if (tab === 'login') {
      tabLogin.classList.add('bg-indigo-600', 'text-white');
      tabLogin.classList.remove('text-slate-300');
      tabCadastro.classList.remove('bg-indigo-600', 'text-white');
      tabCadastro.classList.add('text-slate-300');
      formLogin.classList.remove('hidden');
      formCadastro.classList.add('hidden');
    } else {
      tabCadastro.classList.add('bg-indigo-600', 'text-white');
      tabCadastro.classList.remove('text-slate-300');
      tabLogin.classList.remove('bg-indigo-600', 'text-white');
      tabLogin.classList.add('text-slate-300');
      formCadastro.classList.remove('hidden');
      formLogin.classList.add('hidden');
    }
  };

  window.fazerLogin = async function(event) {
    event.preventDefault();

    const email = document.getElementById('login-email').value;
    const senha = document.getElementById('login-senha').value;

    loginBtn.disabled = true;
    loginBtn.textContent = 'Entrando...';

    const resultado = await loginComEmail(email, senha);

    if (resultado.success) {
      mostrarToast('‚úÖ Login bem-sucedido! Redirecionando...', 'success');
      window.location.href = '/hub.html';
      return;
    }

    mostrarToast('‚ùå ' + resultado.error, 'error');
    loginBtn.disabled = false;
    loginBtn.textContent = 'Entrar';
  };

  window.fazerCadastro = async function(event) {
    event.preventDefault();

    const nome = document.getElementById('cadastro-nome').value;
    const email = document.getElementById('cadastro-email').value;
    const senha = document.getElementById('cadastro-senha').value;

    cadastroBtn.disabled = true;
    cadastroBtn.textContent = 'Criando conta...';

    const resultado = await cadastrarComEmail(email, senha, nome);

    if (resultado.success) {
      mostrarToast('‚úÖ Conta criada! Redirecionando...', 'success');
      window.location.href = '/hub.html';
      return;
    }

    mostrarToast('‚ùå ' + resultado.error, 'error');
    cadastroBtn.disabled = false;
    cadastroBtn.textContent = 'Criar Conta';
  };

  window.loginGoogle = async function() {
    mostrarToast('üîÑ Abrindo Google...', 'info');
    await loginComOAuth('google');
  };

  window.loginGitHub = async function() {
    mostrarToast('üîÑ Abrindo GitHub...', 'info');
    await loginComOAuth('github');
  };

  window.mostrarToast = function(mensagem) {
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toast-message');
    toastMessage.textContent = mensagem;
    toast.classList.remove('hidden');
    setTimeout(() => toast.classList.add('hidden'), 3000);
  };

  (async () => {
    const status = await getUsuarioAtual();
    if (status.success) {
      window.location.href = '/hub.html';
    }
  })();
</script>

</body>
</html>
